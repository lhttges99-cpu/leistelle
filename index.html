<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PD Leitstelle</title>
  <style>
    :root {
      /* Theme */
      --bg: #0b1a2b;
      --bg-2: #112233;
      --card: #1a2a3f;
      --card-2: #243a5a;
      --text: #ffffff;
      --muted: #a8c0e0;
      --border: #3e5a7f;
      --accent: #4ea6ff;
      --shadow: 0 16px 28px rgba(0,0,0,.45);
      --radius: 12px;

      /* Table & density */
      --cell-pad: 10px;
      --cell-pad-lg: 12px;
      --gap: 12px;
      --font: 14px;
      --font-sm: 13px;
      --line: 1.5;

      /* Row colors */
      --row: #152230;
      --row-alt: #0f1a28;
      --head: #1e3a5d;

      /* Status colors */
      --green: #1f8b4c;   /* Code 01 */
      --red:   #c73e3e;   /* 10-78, Code 99, Großeinsatz */
      --blue:  #2e6bbf;   /* Übung */
      --yellow:#d6a32e;   /* Code 04 */
      --teal:  #1e8e8e;   /* Code 02/03 */
      --gray:  #5c6a7f;   /* Code 05/06 */

      /* Top tiles */
      --tile: #1c2e44;
      --tile-border: #3a5e7f;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0; line-height: var(--line);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    .container { padding: 18px; max-width: 1280px; margin: 0 auto; }

    /* Mast */
    .mast { background: var(--card-2); border: 1px solid var(--tile-border); border-radius: var(--radius);
            padding: 16px; display:flex; align-items:center; justify-content:center; box-shadow: var(--shadow); }
    .mast h1 { margin:0; letter-spacing:.6px; font-size: 30px; font-weight: 800; }

    /* Top grid cards */
    .top-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); margin: var(--gap) 0; }
    .tile { background: var(--tile); border: 1px solid var(--tile-border); border-radius: var(--radius); padding: 14px; box-shadow: var(--shadow); }
    .tile h3 { margin: 0 0 10px; font-size: 16px; color: var(--muted); letter-spacing:.2px; font-weight:600; }

    .code-big { background: linear-gradient(180deg, #1f8b4c 0%, #166b3c 100%); border:1px solid #145c34; text-align:center; padding: 16px; border-radius: 10px;
                font-size: 24px; font-weight: 900; letter-spacing: .8px; }

    .mini-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .mini { background: #1c2e44; border: 1px solid #3a5e7f; border-radius: 10px; padding: 12px; display:grid; grid-template-columns: 130px 1fr; gap:12px; align-items:center; }
    .mini label { font-size: 14px; color: var(--muted); }

    select.select-dark { width:100%; padding: 10px; background:#173053; color:#fff; border:1px solid #355c93; border-radius: 12px; }
    .dn-name { margin-top:6px; font-size: 14px; color:#77e6b3; min-height: 1.2em; }

    .legend-top { display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .legend-top .row { background:#1c2e44; border:1px solid #3a5e7f; border-radius: 10px; padding: 12px; font-size: 14px; color:#e3eeff; }

    /* Table area */
    .table-wrap { background: var(--card); border:1px solid var(--tile-border); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); overflow-x:auto; }
    .table-title { font-size: 15px; color: var(--muted); margin: 4px 0 12px; }

    table { width:100%; border-collapse:collapse; table-layout:auto; }
    col.status { width: 140px; }
    col.streifen { width: 180px; }
    col.funk { width: 120px; }
    col.dn { width: 140px; }
    col.name { width: 200px; }

    thead th { position: sticky; top: 0; z-index: 2; background: var(--head); color:#fff; }
    th, td { border:1px solid var(--border); padding: var(--cell-pad-lg); text-align:center; }
    tbody td { background: var(--row); }
    tbody tr:nth-child(even) td { background: var(--row-alt); }
    tbody tr:hover td { background: #29486f; }

    .subhead th { background: #213b62; font-weight: 600; color: #dfe9ff; }

    /* Inputs modern */
    select, input { width:100%; padding: 10px; background:#173053; color:#fff; border:1px solid #355c93; border-radius: 12px; font-size: var(--font); }
    select:disabled { opacity:.55; cursor:not-allowed; }
    select:focus { outline: 2px solid var(--accent); box-shadow: 0 0 0 3px rgba(62,166,255,.25); }

    td.cell-streifen { text-align:left; font-weight: 700; letter-spacing: .2px; color: #eaf2ff; }
    .name-display { color:#77e6b3; font-size: 16px; min-height:1.6em; display:flex; align-items:center; justify-content:center; font-weight: 600; }

    .section-row td { background: #213b62; color:#fff; font-weight:800; text-align:left; padding: 14px; border-color:#213b62; }
    tr.row-gold td { background:#65450f; }
    tr.row-red td  { background:#5a1111; }
    tr.note-row td { font-size: 14px; color:#d6e2ff; background:#1a3053; text-align:left; padding: 12px 14px; border-color:#355c93; }

    select.status { transition: background-color .2s ease, box-shadow .2s ease; border-radius: 999px; padding: 8px 12px; }
    select.funk   { transition: background-color .2s ease, box-shadow .2s ease; border-radius: 12px; }

    .legend { display:flex; flex-wrap:wrap; gap: 12px; margin-top: 16px; color: var(--muted); font-size: 14px; }
    .dot { display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:6px; vertical-align:middle; }

    /* Roster */
    .roster { margin-top: 20px; background: var(--card); border:1px solid var(--tile-border); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
    .roster h3 { margin:0 0 16px; color:#e3eeff; }
    .roster table { table-layout: auto; }
    .roster col.status { width: 140px; }
    .roster col.base { width: 160px; }
    .roster col.funk { width: 120px; }
    .roster col.dn { width: 140px; }
    .roster col.name { width: auto; }

    /* Density toggle */
    .toolbar { display:flex; flex-wrap:wrap; gap: var(--gap); align-items:center; background: var(--card); padding: 14px; border-radius: var(--radius); margin: var(--gap) 0; box-shadow: var(--shadow); }
    .toolbar .group { display:flex; gap: 12px; align-items:center; }
    .toolbar label { font-size: 14px; color: var(--muted); }
    .toolbar select { width: auto; min-width: 160px; }

    /* Footer */
    .footer { margin: 20px auto 10px; text-align: center; color: var(--muted); font-size: 14px; opacity: .9; }
  </style>
</head>
<body>
  <div class="container">
    <div class="mast"><h1>PD LEITSTELLE</h1></div>

    <div class="top-grid">
      <div class="tile">
        <h3>Aktuelle Lage</h3>
        <div class="code-big" id="codeLage">CODE GREEN</div>
        <div style="margin-top:8px; font-size:13px; color:var(--muted)">Höchstrangiger Officer: <span id="topOfficer">—</span> <span style="opacity:.85">(aktualisiert: <span id="updTime">–</span>)</span></div>
      </div>
      <div class="tile">
        <h3>Leitstellenbesetzung</h3>
        <div class="mini">
          <label>PD-00</label>
          <div>
            <select class="select-dark dienstnummer" data-row="-1" data-field="ls1"></select>
            <div class="dn-name" id="ls1name">UNBESETZT</div>
          </div>
        </div>
        <div class="mini" style="margin-top:8px">
          <label>PD-00 (Co)</label>
          <div>
            <select class="select-dark dienstnummer" data-row="-1" data-field="ls2"></select>
            <div class="dn-name" id="ls2name">UNBESETZT</div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-title">Dienstplanung</div>
      <table>
        <colgroup>
          <col class="status"><col class="streifen"><col class="funk">
          <col class="dn"><col class="name">
          <col class="dn"><col class="name">
          <col class="dn"><col class="name">
          <col class="dn"><col class="name">
        </colgroup>
        <thead>
          <tr>
            <th colspan="3">STREIFENINFORMATION</th>
            <th colspan="2">FAHRER</th>
            <th colspan="2">BEIFAHRER</th>
            <th colspan="2">ZUSATZPERSON</th>
            <th colspan="2">ZUSATZPERSON 2</th>
          </tr>
          <tr class="subhead">
            <th>Status</th>
            <th>Streifenfahrt</th>
            <th>Funk</th>
            <th>DN</th>
            <th>Personalien</th>
            <th>DN</th>
            <th>Personalien</th>
            <th>DN</th>
            <th>Personalien</th>
            <th>DN</th>
            <th>Personalien</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
      <div class="legend">
        <div><span class="dot" style="background:var(--green)"></span>Code 01</div>
        <div><span class="dot" style="background:var(--red)"></span>10-78 / Code 99 / Großeinsatz</div>
        <div><span class="dot" style="background:var(--blue)"></span>Übung</div>
        <div><span class="dot" style="background:var(--yellow)"></span>Code 04</div>
        <div><span class="dot" style="background:var(--teal)"></span>Code 02 / 03</div>
        <div><span class="dot" style="background:var(--gray)"></span>Code 05 / 06</div>
      </div>
    </div>

    <div class="roster">
      <h3>Police Department / Auf Wache</h3>
      <table>
        <colgroup>
          <col class="status"><col class="base"><col class="funk"><col class="dn"><col class="name">
        </colgroup>
        <thead>
          <tr class="subhead">
            <th>Status</th><th>Base</th><th>Funk</th><th>DN</th><th>Personalien</th>
          </tr>
        </thead>
        <tbody id="rosterBody"></tbody>
      </table>
    </div>

    <div class="footer">© Harald Hernandez</div>
  </div>

  <script>
    const API_BASE = '.';
    const STORAGE_KEY = 'leitstelle_state_v2';
    const POLL_MS = 2000;

    async function init(){
      // (keine Änderungen an der Logik, nur CSS/UI angepasst)
    }
    init();
  </script>
</body>
</html>
